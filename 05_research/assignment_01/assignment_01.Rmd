---
title: "Reproducible Research: Peer Assessment 1"
output: html_document
---

<br>

## Loading and preprocessing the data

1) Load the data
<br>

```{r}
# data
setwd("C:/Users/JS033085/Desktop/Git/05_research/RepData_PeerAssignment1")
d <- read.csv("activity.csv")
```
<br>

2) Process/transform the data into a format suitable for the analysis

```{r}
# load packages
library(MASS)
library(sqldf)
library(ggplot2)
library(lubridate)

# wrangle data
d$date <- substr(ymd(d$date),1,10)
d$day_of_week <- wday(d$date)

```
<br>

## What is mean total number of steps taken per day?

1) Calculate the number of steps taken per day

```{r}
clean <- d[!is.na(d$steps),]
cleaned_daily <- sqldf("select date, sum(steps) as total_steps from clean group by date")
cleaned_daily
```
<br>

2) Make a histogram of the total number of steps taken each day

```{r}
truehist(cleaned_daily$total_steps, nbins=10)
```
<br>

3) Calculate and report the mean and median of the total number of steps taken per day
```{r}
data.frame(statistic=c("mean","median"), 
           value=c(mean(cleaned_daily$total_steps), median(cleaned_daily$total_steps)))
```
<br>

## What is the average daily activity pattern?

1) Make a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r}
avg <- sqldf("select interval, round(avg(steps),1) as average_steps from clean group by interval")
ggplot(avg, aes(x=interval, y=average_steps)) + geom_line(color="royalblue2") + xlab("Interval") + ylab("Average Steps per Interval")

```
<br>

2) Which 5-minute interval, on average across all the days of the data set, contains the maximum number of steps?

```{r}
max_time <- avg$interval[avg$average_steps == max(avg$average_steps)]
paste0("The 5-minute interval, on average across all the days of the data set, with the maximum number of steps is ", max_time)
```
<br>

## Imputing missing values

1) Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)

```{r}
paste("The number of missing values in the dataset is", sum(is.na(d$steps)))
```
<br>

2) Devise a strategy for filling in all of the missing values in the dataset

*My strategy is to impute missing values using the **average value for the indicated time interval**.  The following R code develops the average values for my imputation strategy:*

```{r}
average_values <- sqldf("select interval, round(avg(steps),1) as avg_steps 
                        from (select * from d where steps is not null) 
                        group by interval")
```
<br>

3) Create a new dataset that is equal to the original dataset but with the missing data filled in

```{r}
imputed <- sqldf("select a.*, b.avg_steps from d as a
                 left join average_values as b on a.interval = b.interval")
imputed$steps[is.na(imputed$steps)] <- imputed$avg_steps[is.na(imputed$steps)]
imputed$avg_steps <- NULL
```
<br>

4a) Make a histogram of the total number of steps taken each day

```{r}
imputed_daily <- sqldf("select date, sum(steps) as total_steps from imputed group by date")
truehist(imputed_daily$total_steps, nbins=10)
```
<br>

4b) Calculate and report the mean and median total number of steps taken per day

```{r}
data.frame(statistic=c("mean","median"), 
           value=c(mean(imputed_daily$total_steps), median(imputed_daily$total_steps)))
```
<br>

4c) Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?

```{r}
data.frame(statistic=c("mean", "median"), 
           pre_imputation=c(mean(cleaned_daily$total_steps), median(cleaned_daily$total_steps)), 
           post_imputation=c(mean(imputed_daily$total_steps), median(imputed_daily$total_steps)), 
           difference=round(c((mean(cleaned_daily$total_steps)-mean(imputed_daily$total_steps)), 
                        (median(cleaned_daily$total_steps)-median(imputed_daily$total_steps))),2))
```
As seen in the table above, the summary statistics are very similar before and after imputing values.  Therefore, there seems to be **very little impact** from imputing the missing variables.
<br><br>

## Are there differences in activity patterns between weekdays and weekends?

1) Create a new factor variable in the dataset with two levels - "weekday" and "weekend" indicating whether a given date is a weekday or weekend day

```{r}
## the 'day_of_week' feature was generated using the 'wday' function from the Lubridate package (applied previously in the pre-processing stage)
d$day_type[d$day_of_week %in% c(2:6)] <- "weekday"
d$day_type[d$day_of_week %in% c(1,7)] <- "weekend"
d$day_type <- as.factor(d$day_type)
```
<br>

2) Make a panel plot containing a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis)

```{r}
avg2 <- sqldf("select interval, day_type, round(avg(steps),1) as average_steps from d group by interval, day_type")
ggplot(avg2, aes(x=interval, y=average_steps)) + geom_line(color="royalblue2") + facet_wrap(~day_type, nrow=2) + 
  xlab("Interval") + ylab("Average Steps per Interval")
```

